name: Version Bump

on:
  workflow_dispatch:
    inputs:
      version_type:
        description: 'Prueba de primera version'
        required: true
        default: 'patch'
        type: choice
        options:
          - patch
          - minor
          - major

jobs:
  bump-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Bump version and push tag
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          
          # Obtener versión actual del archivo VERSION o crear v1.0.0
          if [ -f VERSION ]; then
            VERSION=$(cat VERSION)
          else
            VERSION="1.0.0"
          fi
          
          # Incrementar versión
          IFS='.' read -ra PARTS <<< "$VERSION"
          case "${{ github.event.inputs.version_type }}" in
            major)
              PARTS[0]=$((PARTS[0] + 1))
              PARTS[1]=0
              PARTS[2]=0
              ;;
            minor)
              PARTS[1]=$((PARTS[1] + 1))
              PARTS[2]=0
              ;;
            patch)
              PARTS[2]=$((PARTS[2] + 1))
              ;;
          esac
          
          NEW_VERSION="${PARTS[0]}.${PARTS[1]}.${PARTS[2]}"
          echo $NEW_VERSION > VERSION
          
          git add VERSION
          git commit -m "Bump version to $NEW_VERSION"
          git tag -a "v$NEW_VERSION" -m "Release version $NEW_VERSION"
          git push origin main --tags